syntax = "proto3";

package otp;

import "google/protobuf/empty.proto";

option go_package = "notificationpb/";

// define platform
enum Platform {
  PLATFORM_UNSPECIFIED = 0;
  IOS = 1;
  ANDROID = 2;
  WEB = 3;
}

// Notification service
service NotificationService {
  rpc SaveDeviceToken(DeviceToken) returns (google.protobuf.Empty);
  rpc GetAllDeviceTokens(GetAllDeviceTokensReq) returns (GetAllDeviceTokensRes);

  rpc RemoveDeviceToken(RemoveDeviceTokenReq) returns (google.protobuf.Empty);
  rpc RemoveAllDeviceTokens(RemoveAllDeviceTokensReq) returns (google.protobuf.Empty);

  rpc SendNotification(SendNotificationReq) returns (SendNotificationRes);
  rpc SendNotificationToAccountId(SendNotificationToAccountIdReq) returns (SendNotificationRes);
  rpc SendNotificationToToken(SendNotificationToTokenReq) returns (SendNotificationRes);
  rpc SendNotificationToTopic(SendNotificationToTopicReq) returns (SendNotificationRes);
  rpc SendBulkNotification(SendBulkNotificationReq) returns (SendBulkNotificationRes);
}

message DeviceToken {
  string account_id = 1;
  string fcm_token = 2;
  string device_id = 3;
  string device_name = 4;
  Platform platform = 5;
}

message GetAllDeviceTokensReq {
  string account_id = 1;
}
message GetAllDeviceTokensRes {
  repeated DeviceToken device_tokens = 1;
}

message RemoveDeviceTokenReq {
  string account_id = 1;
  string device_id = 2;
}

message RemoveAllDeviceTokensReq {
  string account_id = 1;
}

message SendNotificationReq {
  string account_id = 1;
  string title = 2;
  string body = 3;
  string image_url = 4;
  map<string, string> data = 5;
}

message SendNotificationToAccountIdReq {
  string account_id = 1;
  string title = 2;
  string body = 3;
  string image_url = 4;
  map<string, string> data = 5;
}

message SendNotificationToTokenReq {
  string fcm_token = 1;
  string title = 2;
  string body = 3;
  string image_url = 4;
  map<string, string> data = 5;
}

message SendNotificationToTopicReq {
  string topic = 1;
  string title = 2;
  string body = 3;
  string image_url = 4;
  map<string, string> data = 5;
}

message SendBulkNotificationReq {
  repeated string fcm_tokens = 1;
  string title = 2;
  string body = 3;
  string image_url = 4;
  map<string, string> data = 5;
}

message SendNotificationRes {
  bool success = 1;
  string message_id = 2;
  string error_message = 3;
}

message SendBulkNotificationRes {
  bool success = 1;
  int32 success_count = 2;
  int32 failure_count = 3;
  repeated string failed_tokens = 4;
}
